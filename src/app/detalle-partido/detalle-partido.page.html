<ion-header class="ion-no-border">
  <ion-toolbar class="cyber-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" icon="chevron-back" text="VOLVER"></ion-back-button>
    </ion-buttons>
    <ion-title class="rajdhani-title">DETALLE PARTIDO</ion-title>
    
    <div slot="end" class="user-chip">
      <ion-icon name="person-circle-outline"></ion-icon>
      <span>{{ currentUser.username }}</span>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="cyber-bg">
  <div class="main-layout" *ngIf="match">
    
    <div class="content-area">
      
      <div class="score-card">
        <div class="match-header">
          <div class="team-block">
            <div class="badge-container" (click)="goToTeamDetail(match.home, $event)">
              <img [src]="match.homeBadge" class="team-badge">
            </div>
            <h2 class="team-name">{{ match.home }}</h2>
            <span class="tag-home">LOCAL</span>
          </div>

          <div class="score-block">
            <div class="big-score">
              <span>{{ match.homeScore }}</span>
              <span class="dash">-</span>
              <span>{{ match.awayScore }}</span>
            </div>
            <div class="match-meta">
              <span class="status-pill" [class.live]="match.status === 'live'">
                {{ match.status === 'live' ? 'EN VIVO ' + (match.time || "00'") : (match.status === 'finished' ? 'FINALIZADO' : 'PENDIENTE') }}
              </span>
              <span class="date">{{ match.date | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>

          <div class="team-block">
            <div class="badge-container" (click)="goToTeamDetail(match.away, $event)">
              <img [src]="match.awayBadge" class="team-badge">
            </div>
            <h2 class="team-name">{{ match.away }}</h2>
            <span class="tag-away">VISITANTE</span>
          </div>
        </div>
      </div>

      <div class="events-card">
        <div class="card-title">
          <h3><ion-icon name="list-outline"></ion-icon> Minuto a Minuto</h3>
        </div>

        <div class="timeline">
          <div class="empty-events" *ngIf="!match.events || match.events.length === 0">
            <p>El partido está tranquilo... de momento.</p>
          </div>

          <div class="event-row" *ngFor="let ev of match.events">
            <div class="ev-time">{{ ev.minute }}'</div>
            
            <div class="ev-icon">
              <ion-icon 
                [name]="ev.type === 'goal' ? 'football' : 'alert-circle'" 
                [class.icon-goal]="ev.type === 'goal'">
              </ion-icon>
            </div>
            
            <div class="ev-desc">
              <span class="action-text">
                <ng-container *ngIf="ev.type === 'goal'">
                  <strong class="text-goal">¡GOOOOOOL!</strong> de <span class="player-highlight">{{ ev.player }}</span>
                  <span class="score-snapshot">({{ ev.score }})</span>
                </ng-container>

                <ng-container *ngIf="ev.type !== 'goal'">
                  {{ ev.type | uppercase }} - {{ ev.player }}
                </ng-container>
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="betting-card" *ngIf="match.status === 'pending'">
        <div class="card-title"><h3>Realizar Predicción</h3></div>
        <div class="bet-controls">
          <div class="control-group">
            <label>{{ match.home }}</label>
            <input type="number" [(ngModel)]="betData.homeScore" class="score-input">
          </div>
          <span class="vs">vs</span>
          <div class="control-group">
            <label>{{ match.away }}</label>
            <input type="number" [(ngModel)]="betData.awayScore" class="score-input">
          </div>
        </div>
        <button class="place-bet-btn" (click)="placeBet()">
          CONFIRMAR APUESTA (100 CR)
        </button>
      </div>

    </div>

    <div class="side-panel">
      <div class="chat-container">
        <div class="chat-header-box">
          <ion-icon name="chatbubbles-outline"></ion-icon> COMENTARIOS EN VIVO
        </div>
        <div class="messages-scroll">
          <div class="msg-bubble" *ngFor="let msg of messages" [class.own]="msg.username === currentUser.username">
            <div class="msg-meta">
              <span class="msg-user">{{ msg.username }}</span>
              <span class="msg-time">{{ msg.time }}</span>
            </div>
            <div class="msg-text">{{ msg.text }}</div>
          </div>
        </div>
        <div class="chat-input-box">
          <input type="text" placeholder="Escribe un mensaje..." [(ngModel)]="newMessage" (keyup.enter)="sendMessage()">
          <button (click)="sendMessage()"><ion-icon name="send"></ion-icon></button>
        </div>
      </div>
    </div>

  </div>
</ion-content>